<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Electoral Systems Simulator</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üó≥Ô∏è Electoral Systems Simulator</h1>
            <p class="subtitle">Compare different voting systems and understand their implications</p>
        </header>

        <div class="main-content">
            <!-- Electoral System Selection -->
            <section class="card">
                <h2>1. Choose Electoral System</h2>
                <select id="electoralSystem" class="system-select">
                    <option value="">-- Select an Electoral System --</option>
                    <option value="fptp">First-Past-the-Post (FPTP) / Single-Member Plurality (SMP)</option>
                    <option value="trs">Two-Round System (TRS) / Runoff Voting</option>
                    <option value="irv">Instant-Runoff Voting (IRV) / Ranked-Choice Voting (RCV)</option>
                    <option value="party-list-closed">Party-List Proportional Representation - Closed List</option>
                    <option value="party-list-open">Party-List Proportional Representation - Open List</option>
                    <option value="stv">Single Transferable Vote (STV)</option>
                    <option value="mmp">Mixed-Member Proportional (MMP) / Additional Member System (AMS)</option>
                    <option value="parallel">Parallel Voting / Mixed-Member Majoritarian (MMM)</option>
                    <option value="block">Block Voting (Plurality-at-Large)</option>
                    <option value="limited">Limited Voting (LV)</option>
                    <option value="approval">Approval Voting</option>
                </select>
                <div id="systemDescription" class="system-description"></div>
            </section>

            <!-- Party Management Section -->
            <section class="card" id="partiesSection" style="display: none;">
                <h2><span class="section-number">2</span>. Political Parties</h2>
                <div class="input-group">
                    <input type="text" id="partyName" placeholder="Party name (e.g., Progressive Party)">
                    <div class="color-picker-wrapper">
                        <div class="color-presets" id="colorPresets">
                            <button type="button" class="color-preset" data-color="#e74c3c" style="background: #e74c3c;" title="Red"></button>
                            <button type="button" class="color-preset" data-color="#3498db" style="background: #3498db;" title="Blue"></button>
                            <button type="button" class="color-preset" data-color="#2ecc71" style="background: #2ecc71;" title="Green"></button>
                            <button type="button" class="color-preset" data-color="#f39c12" style="background: #f39c12;" title="Orange"></button>
                            <button type="button" class="color-preset" data-color="#9b59b6" style="background: #9b59b6;" title="Purple"></button>
                            <button type="button" class="color-preset" data-color="#1abc9c" style="background: #1abc9c;" title="Teal"></button>
                            <button type="button" class="color-preset" data-color="#e91e63" style="background: #e91e63;" title="Pink"></button>
                            <button type="button" class="color-preset" data-color="#34495e" style="background: #34495e;" title="Dark Gray"></button>
                            <button type="button" class="color-preset" data-color="#f1c40f" style="background: #f1c40f;" title="Yellow"></button>
                            <button type="button" class="color-preset custom-color" onclick="document.getElementById('partyColorPicker').click();" title="Custom Color">
                                <span style="font-size: 16px;">+</span>
                            </button>
                        </div>
                        <input type="color" id="partyColorPicker" style="display: none;" value="#3498db">
                        <input type="hidden" id="partyColor" value="#3498db">
                    </div>
                    <button onclick="addParty()" class="btn-primary">Add Party</button>
                </div>
                <div id="partiesList" class="items-list"></div>
            </section>

            <!-- Candidate Management Section -->
            <section class="card" id="candidatesSection" style="display: none;">
                <h2><span class="section-number">3</span>. Candidates</h2>
                <div class="input-group">
                    <input type="text" id="candidateName" placeholder="Candidate name">
                    <select id="candidateParty">
                        <option value="">Select Party</option>
                    </select>
                    <button onclick="addCandidate()" class="btn-primary">Add Candidate</button>
                </div>
                <div style="margin-bottom: 15px;">
                    <button onclick="autoGenerateCandidates()" class="btn-secondary">
                        ‚ö° Auto-Generate One Candidate per Party
                    </button>
                </div>
                <div id="candidatesList" class="items-list"></div>
            </section>

            <!-- Voting Input Section -->
            <section class="card" id="votingSection" style="display: none;">
                <h2><span class="section-number">4</span>. Voting Results</h2>
                
                <!-- Advanced Features (Python Backend) -->
                <div id="advancedFeatures" style="display: none; background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #2196f3;">
                    <h4 style="margin: 0 0 10px 0; color: #1976d2;">üêç Advanced Features (Python Backend)</h4>
                    
                    <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 15px;">
                        <button onclick="showBallotGenerator()" class="btn-secondary" style="background: linear-gradient(135deg, #2196f3 0%, #21cbf3 100%);">
                            üé≤ Generate Realistic Ballots
                        </button>
                        <button onclick="showStrategicSimulator()" class="btn-secondary" style="background: linear-gradient(135deg, #9c27b0 0%, #e91e63 100%);">
                            üéØ Simulate Strategic Voting
                        </button>
                        <button onclick="showBatchSimulator()" class="btn-secondary" style="background: linear-gradient(135deg, #ff9800 0%, #ff5722 100%);">
                            ‚ö° Batch Simulation (100k voters)
                        </button>
                        <button onclick="saveCurrentScenario()" class="btn-secondary" style="background: linear-gradient(135deg, #4caf50 0%, #8bc34a 100%);">
                            üíæ Save & Share Scenario
                        </button>
                    </div>
                    
                    <!-- Ballot Generator Modal Content -->
                    <div id="ballotGeneratorPanel" style="display: none; background: white; padding: 15px; border-radius: 8px; margin-top: 10px;">
                        <h5 style="margin-top: 0;">Generate Realistic Voter Ballots</h5>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <label>Number of Voters:</label>
                                <input type="number" id="genNumVoters" value="10000" min="100" max="1000000" style="width: 100%; padding: 8px; margin-top: 5px;">
                            </div>
                            <div>
                                <label>Ideological Distribution:</label>
                                <select id="genDistribution" style="width: 100%; padding: 8px; margin-top: 5px;">
                                    <option value="normal">Normal (Bell Curve)</option>
                                    <option value="polarized">Polarized (Two Extremes)</option>
                                    <option value="left">Left-Skewed</option>
                                    <option value="right">Right-Skewed</option>
                                    <option value="uniform">Uniform</option>
                                </select>
                            </div>
                        </div>
                        <button onclick="generateRealisticBallots()" style="width: 100%; margin-top: 10px; padding: 10px; background: #2196f3; color: white; border: none; border-radius: 6px; cursor: pointer;">
                            Generate Ballots
                        </button>
                    </div>
                    
                    <!-- Strategic Voting Panel -->
                    <div id="strategicVotingPanel" style="display: none; background: white; padding: 15px; border-radius: 8px; margin-top: 10px;">
                        <h5 style="margin-top: 0;">Strategic Voting Simulation</h5>
                        <p style="color: #666; font-size: 0.9em;">See how voters might vote tactically to avoid "wasted votes"</p>
                        <button onclick="runStrategicSimulation()" style="width: 100%; padding: 10px; background: #9c27b0; color: white; border: none; border-radius: 6px; cursor: pointer;">
                            Run Strategic Simulation
                        </button>
                        <div id="strategicResults" style="margin-top: 10px;"></div>
                    </div>
                    
                    <!-- Batch Simulation Panel -->
                    <div id="batchSimPanel" style="display: none; background: white; padding: 15px; border-radius: 8px; margin-top: 10px;">
                        <h5 style="margin-top: 0;">Batch System Comparison</h5>
                        <p style="color: #666; font-size: 0.9em;">Run large-scale simulation across multiple systems simultaneously</p>
                        <div style="margin: 10px 0;">
                            <label><input type="checkbox" value="fptp" checked> FPTP</label>
                            <label style="margin-left: 15px;"><input type="checkbox" value="irv" checked> IRV</label>
                            <label style="margin-left: 15px;"><input type="checkbox" value="stv" checked> STV</label>
                        </div>
                        <button onclick="runBatchSimulation()" style="width: 100%; padding: 10px; background: #ff9800; color: white; border: none; border-radius: 6px; cursor: pointer;">
                            Run Batch Simulation (100,000 voters)
                        </button>
                        <div id="batchResults" style="margin-top: 10px;"></div>
                    </div>
                </div>
                
                <!-- Race Type Selection -->
                <div class="race-type-selector">
                    <label style="display: block; margin-bottom: 10px; font-weight: 600; color: #667eea;">
                        Election Scope:
                    </label>
                    <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                        <label class="radio-option">
                            <input type="radio" name="raceType" value="single" checked onchange="updateRaceType()">
                            <span>üèÅ Single Race (1 seat or district)</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="raceType" value="legislative" onchange="updateRaceType()">
                            <span>üèõÔ∏è Entire Legislature (10 seats)</span>
                        </label>
                    </div>
                    <p id="raceTypeDescription" style="color: #666; font-size: 0.9em; font-style: italic; margin-bottom: 20px;">
                        Single race: Simulate one electoral district or seat (e.g., one House district).
                    </p>
                </div>
                
                <div id="electoralThresholdContainer" style="display: none; margin-bottom: 20px;">
                    <label for="electoralThreshold" style="display: block; margin-bottom: 8px; font-weight: 600; color: #667eea;">
                        Electoral Threshold (%)
                    </label>
                    <input type="number" id="electoralThreshold" min="0" max="100" step="0.1" value="5" 
                           style="width: 150px; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px;">
                    <p style="margin-top: 8px; color: #666; font-size: 0.9em; font-style: italic;">
                        Minimum vote share (%) a party needs to win seats. Common values: 3%, 4%, or 5%
                    </p>
                </div>
                
                <div id="allocationMethodContainer" style="display: none; margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #667eea;">
                        Seat Allocation Method
                    </label>
                    <select id="allocationMethod" style="width: 250px; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px;">
                        <option value="dhondt">D'Hondt (favors larger parties)</option>
                        <option value="sainte-lague">Sainte-Lagu√´ (more proportional)</option>
                    </select>
                    <p style="margin-top: 8px; color: #666; font-size: 0.9em; font-style: italic;">
                        D'Hondt tends to give bonus seats to larger parties; Sainte-Lagu√´ is more proportional to small parties.
                    </p>
                </div>
                
                <div id="votingInputs"></div>
                <button onclick="calculateResults()" class="btn-calculate">üó≥Ô∏è Calculate Election Results</button>
            </section>

            <!-- Results Section -->
            <section class="card results-section" id="resultsSection" style="display: none;">
                <h2>üìä Election Results</h2>
                <div id="results"></div>
                
                <h3>‚öñÔ∏è Arrow's Impossibility Theorem Analysis</h3>
                <div id="arrowAnalysis" class="arrow-analysis"></div>
            </section>
        </div>
    </div>

    <!-- Chart.js for improved visualizations -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="calculations.js"></script>
    <script src="state-manager.js"></script>
    <script src="api-client.js"></script>
    <script src="advanced-features.js"></script>
    <script src="app.js"></script>
</body>
</html>

