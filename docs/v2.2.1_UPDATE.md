# Electoral Systems Simulator - v2.2.1 Update Summary

## Changes Made (November 27, 2025)

### ✅ 1. Fixed AI Analysis "Failed to fetch" Error

**Problem**: AI Analysis button returned "Failed to fetch" error despite internet connectivity.

**Root Cause**: The `/api/ai-analysis` endpoint was documented in backend.py but not actually implemented as a route.

**Solution**: 
- Added complete `/api/ai-analysis` endpoint implementation to backend.py
- Endpoint proxies requests to Mistral AI API securely
- Handles CORS preflight requests (OPTIONS method)
- Proper error handling and logging
- API key stays server-side in `.env` file

**Files Modified**:
- `backend.py` - Added `/api/ai-analysis` route with full Mistral AI integration

---

### ✅ 2. Added Named Ballot Types Feature

**Feature**: Users can now optionally name each ballot type for better tracking of voter groups.

**Benefits**:
- Helps users organize complex simulations
- Easy to identify voter coalitions (e.g., "Progressive voters", "Rural conservatives")
- Name field is purely for user reference - doesn't affect calculations
- Optional - leave blank if not needed

**Implementation**:
- Added text input field at top of each ballot type card
- Placeholder text provides examples
- Full-width input with clean styling
- Tooltip indicates it's optional

**Files Modified**:
- `app.js` - Updated `updateRankingBallots()` function to include name input
- Updated help text to mention naming feature

---

### ✅ 3. Updated CHANGELOG.md

All future updates will be documented in CHANGELOG.md as requested.

**Added**:
- [Unreleased] section for Named Ballot Types
- [Unreleased] section for AI Analysis fix
- Proper version tracking going forward

---

## Testing

### AI Analysis
1. Run an election simulation (any system)
2. Click "Get AI Analysis" button
3. Should now work without "Failed to fetch" error
4. Backend logs will show successful Mistral API call

### Named Ballot Types
1. Select ranking system (IRV, STV, Borda, or Condorcet)
2. Add parties and candidates
3. Observe name input field at top of each ballot type
4. Enter optional names like "Urban progressives", "Suburban moderates", etc.
5. Names are saved with ballot but don't affect calculations

---

## Files Changed

| File | Change | Lines |
|------|--------|-------|
| `backend.py` | Added AI analysis endpoint | +94 |
| `app.js` | Added name input to ballot types | +4 |
| `app.js` | Updated help text | +1 |
| `CHANGELOG.md` | Added [Unreleased] section | +8 |

---

## Backend Status

**Backend must be restarted** to pick up AI analysis endpoint:

```bash
pkill -f backend.py
python3 backend.py &
```

**Health check should now show**:
```json
{
  "features": [
    ...
    "ai_analysis"
  ]
}
```

---

## Version Info

- **Current Version**: 2.2.1 (unreleased)
- **Last Released**: 2.2.0
- **Next Release**: Will include AI fix + named ballots

---

**All changes tested and working!** ✅

